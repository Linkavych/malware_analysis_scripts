#!/usr/bin/env python3
"""
Python script to automate some of the initial phases of malware analysis

Target for this script is ELF malware

Author: Adam V. Link
Date: 2022-07-04
"""
import sys
import subprocess
import hashlib
import tlsh
import telfhash

BUFSIZE = 4096
FILE = sys.argv[1]


def hash_file(file):
    md5 = hashlib.md5()
    sha256 = hashlib.sha256()

    with open(file, "rb") as f:
        while True:
            data = f.read(BUFSIZE)
            if not data:
                break
            md5.update(data)
            sha256.update(data)

    print("MD5:\t\t  {0}".format(md5.hexdigest()))
    print("SHA256:\t\t  {0}".format(sha256.digest()))


def get_elfhash(file):
    stuff = telfhash.telfhash(file)
    for i in stuff:
        print(f"ELF Symbols Hash: {i['telfhash']}")


def tlsh_hash(file):
    with open(file, "rb") as f:
        data = f.read()
    print("TLSH:\t\t  {0}".format(tlsh.hash(data)))


def get_ssdeep(file):
    args = {"/usr/bin/ssdeep", file}
    res = subprocess.check_output(args)
    new_res = res.decode().split("\n")
    str1 = new_res[1].split(",")
    print(f"SSDEEP:\t\t  {str1[0]}")


if __name__ == "__main__":
    hash_file(FILE)
    get_elfhash(FILE)
    tlsh_hash(FILE)
    get_ssdeep(FILE)
