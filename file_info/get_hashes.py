#!/usr/bin/env python3
"""
A simple program to quickly grab the commonly used hashes of a provided file

Author: @linkavych
Date: 2022-07-20
"""

import sys
import hashlib
import pathlib

from typing import Optional

# Import CLI Stuff - rich and typer
from rich import print as rprint
from rich.console import Console
from rich.table import Table
from rich.panel import Panel

# import typer
import typer


def md5_hash(filename: str):
    """
    Receive a filename and return the md5 hash of the file
    """
    md5 = hashlib.md5()

    with open(filename, "rb") as f:
        chunk = 0
        while chunk != b"":
            chunk = f.read(1024)
            md5.update(chunk)

    return md5.hexdigest()


def sha1_hash(filename: str):
    """
    Receive a filename and return the sha1 valuie of the file
    """
    sha1 = hashlib.sha1()

    with open(filename, "rb") as f:
        chunk = 0
        while chunk != b"":
            chunk = f.read(1024)
            sha1.update(chunk)

    return sha1.hexdigest()


def sha256_hash(filename: str):
    """
    Receive a filename and return the sha1 valuie of the file
    """
    sha256 = hashlib.sha256()

    with open(filename, "rb") as f:
        chunk = 0
        while chunk != b"":
            chunk = f.read(1024)
            sha256.update(chunk)

    return sha256.hexdigest()


def main(dirpath: str = typer.Argument(pathlib.Path.cwd()), recursive: bool = False):
    if recursive:
        files = pathlib.Path(dirpath).rglob("*")
    else:
        files = pathlib.Path(dirpath).glob("*")

    console = Console()

    table = Table(show_header=True, header_style="bold blue")
    table.add_column("File Name", style="bold red", justify="left")
    table.add_column("md5 Hash", justify="center")
    table.add_column("sha1 hash", justify="center")
    table.add_column("sha256 Hash", justify="center")

    for file in files:
        if file.is_dir():
            continue
        else:
            md5 = md5_hash(file)
            sha1 = sha1_hash(file)
            sha256 = sha256_hash(file)
            table.add_row(file.name, md5, sha1, sha256)

    console.print(table)


if __name__ == "__main__":
    typer.run(main)
